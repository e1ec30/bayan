import logging
import sys

import angr

from explorers import EUPExplorer, Explorer, NaiveExplorer
from main import run_with_timeout
from sims import getopt_hook

loop_head = 0x4056d6

proj = angr.Project("/home/e1ec30/workspace/code/bayan/bayan/libtiff/my_build/bin/tiffcp", load_options={"auto_load_libs":False})
entry = proj.factory.entry_state(args=["tiffcp", "/tmp/poc", "/tmp/foo"])

poc_file = open("../poc", "rb")
poc_raw = poc_file.read()
poc_file.read()

poc = angr.SimFile("/tmp/poc", content=poc_raw, concrete=True, writable=False, has_end=True)
out = angr.SimFile("/tmp/foo")
entry.fs.insert("/tmp/poc", poc)
entry.fs.insert("/tmp/foo", out)

sim = proj.factory.simgr(entry)

run_with_timeout(sim.run, 1 * 60)
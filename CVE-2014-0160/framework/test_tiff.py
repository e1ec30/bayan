import logging
import sys

import angr

from explorers import EUPExplorer, Explorer, NaiveExplorer
from main import run_with_timeout
from sims import getopt_hook, strlen_hook

proj = angr.Project("/home/e1ec30/workspace/code/bayan/bayan/libtiff/my_build/bin/tiffcp", load_options={"auto_load_libs":False})
entry = proj.factory.entry_state(args=["tiffcp", "./poc", "/tmp/foo"], concrete_fs=True, options=angr.options.unicorn)

proj.hook_symbol("getopt", getopt_hook())
proj.hook_symbol("strlen", strlen_hook())

loop_head = 0x405747

def test_exp(exp, timeout, *args):
    explorer = exp(proj, entry)
    run_with_timeout(explorer.go, timeout, *args)
    return explorer

if len(sys.argv) > 1:
    seconds = sys.argv[2]
else:
    seconds = 5 * 60
#logging.getLogger().setLevel('ERROR')
res = test_exp(EUPExplorer, 10 * 60, loop_head, 2, "c")